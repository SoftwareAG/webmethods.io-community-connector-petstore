
apply plugin: 'application'
apply plugin: 'distribution'
apply plugin: 'jcreatenodendf'
apply plugin: 'maven-publish'

buildscript { ext {
bas = [
version : 'v2.0.2',
] }
dependencies { classpath(
"com.softwareag.connector:plugin:v2.0.2")
repositories {
    println 'Plugin repo Code'

    // Use JCenter for resolving dependencies.
    mavenCentral()
    maven{
    url "${project.buildDependencyURL}/${project.buildDependencyOrganization}/${project.buildDependencyRepoName}"
    credentials {
              username = project.buildDependencyOrganization//"${project.property('github.organization')}"//project.findProperty("gpr.user") ?: System.getenv("GITHUB_USERNAME")
              password = project.buildDependencyToken//secretsProperties['GH_SEC_TOKEN']//"e8a7800a8044f4386447b946073e4325435efe7d"//project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
          }
      }
    }
  }
}


repositories {
    //provider.package.name
    // Use JCenter for resolving dependencies.
    mavenCentral()
    maven{
        url "${project.buildDependencyURL}/${project.buildDependencyOrganization}/${project.buildDependencyRepoName}"
        credentials {
            username = project.buildDependencyOrganization//"${project.property('github.organization')}"//project.findProperty("gpr.user") ?: System.getenv("GITHUB_USERNAME")
            password = project.buildDependencyToken//secretsProperties['GH_SEC_TOKEN']//"e8a25435efe7d"//project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
        }
    }
}

sourceSets {
    main {
        java {
            srcDirs = ['code/source']
        }
        resources {
            srcDirs = ['resources']
        }

    }

}
dependencies {
    println 'dependency Code'
    // Use JUnit test framework.
    //testImplementation 'junit:junit:4.13'

    // This dependency is used by the application.
    //compileOnly 'org.apache.commons:commons-collections4:4.4'

		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-is:10.5.0'
    compileOnly 'com.softwareag.cloudstreams:cs-connector:10.5.0.3'//more than 100 errors when removed
    compileOnly 'com.softwareag.cloudstreams:cloudstreams-client-common:10.5.1'//60 errors when removed
		//compileOnly 'com.softwareag.is:wm-isproxy:10.5.0'
		//compileOnly 'com.softwareag.is:wm-is-osgi-profile:10.5.0'
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-core:10.5.0'//com.softwareag.cloudstreams
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-upgrade:10.5.0'
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-connector-tooling-api:10.5.0'
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-connector-tooling-api-impl:10.5.0'
		compileOnly 'com.softwareag.cloudstreams:cloudstreams-cdk:10.5.0'//38 errors when removed
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-connfactory:10.5.0'
		//compileOnly 'com.softwareag.cloudstreams:cloudstreams-bundle:10.5.0'
        //compileOnly 'com.softwareag.cloudstreams:cloudstreams-metadata-handler:10.5.0'
        compileOnly 'com.softwareag.isclient:is-client:10.5.0' //more than 100 errors when removed
        compileOnly 'com.softwareag.isserver:wm-isserver:10.5.0'//74 errors when removed

}

task assembleArtifact(type: Zip, group: 'wm') {
    def reponame = project.projectreponame
    archiveName "${project.providerPackageName}.zip"
    destinationDir file("${rootDir}/build/tmpzip")//    ("${buildDir}/libs/")
    from "${project.projectDir}/build/ISTemp" //,code,connectors,config,resources"
    description "Assemble archive"
    exclude "build"
    exclude "libs"

}


task copyJavaClass(type: Copy) {
  from 'build/classes/java/main'
  into "${project.projectDir}/code/classes"
}
task copyAllFilesToISTemp(type: Copy){
  from "${project.projectDir}"//"${project.rootDir}"
  into "${project.projectDir}/build/ISTemp"
  exclude '.settings', 'bin', 'build/**', '**/*.gradle', '**/*.classpath', '**/*.project', '**/*.java', '**/*.frag', '**/*.bak', 'code/source', 'code/jars/cloudstreams-connector-utils.jar', '.externalToolBuilders', 'classes'

}
task deleteFragFiles(type: Delete) {
    delete fileTree("${project.rootDir}") {
        include '**/*.asd'
    }
}

        jCreateNodeNdf.dependsOn compileJava
          copyJavaClass.dependsOn jCreateNodeNdf
 copyAllFilesToISTemp.dependsOn copyJavaClass
     assembleArtifact.dependsOn copyAllFilesToISTemp
